.. _CN Structures:

==========================
CN Structures
==========================

.. toctree::
   :maxdepth: 1


* :ref:`CNetwork<CNetwork>`
* :ref:`CNetworkConnectionSettings<CNetworkConnectionSettings>`
* :ref:`CNetworkWindow<CNetworkWindow>`


.. _CNetwork:

CNetwork
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

+------------+----------+---------------------------------------------------------------+-------------------------------+
| **Offset** | **Size** | **Type**                                                      | **Field**                     |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0x00       | 16       | ``GUID``                                                      | m_nApplicationGuid            |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0x10       | 1        | unsigned char                                                 | m_bApplicationGuidDefined     |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0x11       | 1        | unsigned char                                                 | m_bAutoConnectCheck           |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0x12       | 1        | unsigned char                                                 | m_bServiceProviderEnumerated  |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0x13       | 1        | unsigned char                                                 | m_bServiceProviderSelected    |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0x14       | 4        | int                                                           | m_nServiceProvider            |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0x18       | 4        | int                                                           | m_nTotalServiceProviders      |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0x1C       | 16       | :ref:`CString<CString>`                                       | m_ppszServiceProviderNames[4] |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0x2C       | 16       | ``DP_ProviderID``                                             | m_pnServiceProviderIDS[4]     |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0x3C       | 1        | unsigned char                                                 | m_bConnectionInitialized      |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0x3D       | 1        | unsigned char                                                 | m_bSocketConnecting           |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0x3E       | 1        | unsigned char                                                 | m_bSocketConnected            |
+------------+----------+---------------------------------------------------------------+-------------------------------+
|            | 1        |                                                               | ``<padding>``                 |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0x40       | 4        | :ref:`CString<CString>`                                       | m_sIPAddress                  |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0x44       | 1        | unsigned char                                                 | padding2                      |
+------------+----------+---------------------------------------------------------------+-------------------------------+
|            | 3        |                                                               | ``<padding>``                 |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0x48       | 4        | void\*                                                        | m_lpDPAddress                 |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0x4C       | 4        | unsigned long                                                 | m_dwDPAddressSize             |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0x50       | 4        | :ref:`CString<CString>`                                       | m_version                     |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0x54       | 1        | unsigned char                                                 | m_bSessionSelected            |
+------------+----------+---------------------------------------------------------------+-------------------------------+
|            | 3        |                                                               | ``<padding>``                 |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0x58       | 4        | int                                                           | m_nSession                    |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0x5C       | 1        | unsigned char                                                 | m_bSessionNameToMake          |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0x5D       | 1        | unsigned char                                                 | padding3                      |
+------------+----------+---------------------------------------------------------------+-------------------------------+
|            | 2        |                                                               | ``<padding>``                 |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0x60       | 4        | :ref:`CString<CString>`                                       | m_sSessionNameToMake          |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0x64       | 4        | :ref:`CString<CString>`                                       | m_sSessionDescriptionToMake   |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0x68       | 1        | unsigned char                                                 | m_bSessionPasswordEnabled     |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0x69       | 1        | unsigned char                                                 | padding4                      |
+------------+----------+---------------------------------------------------------------+-------------------------------+
|            | 2        |                                                               | ``<padding>``                 |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0x6C       | 4        | :ref:`CString<CString>`                                       | m_sSessionPassword            |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0x70       | 1        | unsigned char                                                 | m_bAllowNewConnections        |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0x71       | 1        | unsigned char                                                 | m_bConnectionEstablished      |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0x72       | 1        | unsigned char                                                 | m_bIsHost                     |
+------------+----------+---------------------------------------------------------------+-------------------------------+
|            | 1        |                                                               | ``<padding>``                 |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0x74       | 72       | ``DPWrapper``                                                 | m_directPlay                  |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0xBC       | 4        | int                                                           | m_nMaxPlayers                 |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0xC0       | 4        | unsigned long                                                 | m_dwSessionFlags              |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0xC4       | 1        | unsigned char                                                 | m_bMaxPlayersDefined          |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0xC5       | 1        | unsigned char                                                 | m_bSessionOptionsDefined      |
+------------+----------+---------------------------------------------------------------+-------------------------------+
|            | 2        |                                                               | ``<padding>``                 |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0xC8       | 4        | :ref:`CString<CString>`                                       | m_sJoinedGame                 |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0xCC       | 4        | :ref:`CString<CString>`                                       | m_sLeftGame                   |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0xD0       | 4        | :ref:`CString<CString>`                                       | m_sDroppedGame                |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0xD4       | 1        | unsigned char                                                 | m_bPlayerNameToMake           |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0xD5       | 1        | unsigned char                                                 | m_bPlayerCreated              |
+------------+----------+---------------------------------------------------------------+-------------------------------+
|            | 2        |                                                               | ``<padding>``                 |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0xD8       | 4        | int                                                           | m_idLocalPlayer               |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0xDC       | 4        | :ref:`CString<CString>`                                       | m_sLocalPlayerName            |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0xE0       | 4        | int                                                           | m_nTotalPlayers               |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0xE4       | 24       | :ref:`CString<CString>`                                       | m_psPlayerName[6]             |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0xFC       | 24       | int                                                           | m_pPlayerID[6]                |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0x114      | 6        | unsigned char                                                 | m_pbPlayerVisible[6]          |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0x11A      | 6        | unsigned char                                                 | m_pbPlayerEnumerateFlag[6]    |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0x120      | 4        | int                                                           | m_nLocalPlayer                |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0x124      | 4        | int                                                           | m_nHostPlayer                 |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0x128      | 4        | :ref:`CString<CString>`                                       | m_sHostIPAddress              |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0x12C      | 4        | int                                                           | m_bAnnounceNewPlayers         |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0x130      | 912      | :ref:`CNetworkWindow<CNetworkWindow>`                         | m_pSlidingWindow[6]           |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0x4c0      | 152      | :ref:`CNetworkWindow<CNetworkWindow>`                         | m_SystemWindow                |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0x558      | 1024     | unsigned long                                                 | m_dwCRC32[256]                |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0x958      | 12       | :ref:`CNetworkConnectionSettings<CNetworkConnectionSettings>` | m_connectionSettings          |
+------------+----------+---------------------------------------------------------------+-------------------------------+
| 0x964      | 4        | unsigned long                                                 | m_lastMessage                 |
+------------+----------+---------------------------------------------------------------+-------------------------------+

Asm Definition

::


   CNetwork                         struct
     m_nApplicationGuid             GUID <>
     m_bApplicationGuidDefined      db ?
     m_bAutoConnectCheck            db ?
     m_bServiceProviderEnumerated   db ?
     m_bServiceProviderSelected     db ?
     m_nServiceProvider             dd ?
     m_nTotalServiceProviders       dd ?
     m_ppszServiceProviderNames     CString 4 dup ({})
     m_pnServiceProviderIDS         DP_ProviderID 4 dup ({})
     m_bConnectionInitialized       db ?
     m_bSocketConnecting            db ?
     m_bSocketConnected             db ?
                                    db ? ; padding
     m_sIPAddress                   CString <>
     padding2                       db ?
                                    db ? ; padding
                                    db ? ; padding
                                    db ? ; padding
     m_lpDPAddress                  dd ? ; void*
     m_dwDPAddressSize              dd ?
     m_version                      CString <>
     m_bSessionSelected             db ?
                                    db ? ; padding
                                    db ? ; padding
                                    db ? ; padding
     m_nSession                     dd ?
     m_bSessionNameToMake           db ?
     padding3                       db ?
                                    db ? ; padding
                                    db ? ; padding
     m_sSessionNameToMake           CString <>
     m_sSessionDescriptionToMake    CString <>
     m_bSessionPasswordEnabled      db ?
     padding4                       db ?
                                    db ? ; padding
                                    db ? ; padding
     m_sSessionPassword             CString <>
     m_bAllowNewConnections         db ?
     m_bConnectionEstablished       db ?
     m_bIsHost                      db ?
                                    db ? ; padding
     m_directPlay                   DPWrapper <>
     m_nMaxPlayers                  dd ?
     m_dwSessionFlags               dd ?
     m_bMaxPlayersDefined           db ?
     m_bSessionOptionsDefined       db ?
                                    db ? ; padding
                                    db ? ; padding
     m_sJoinedGame                  CString <>
     m_sLeftGame                    CString <>
     m_sDroppedGame                 CString <>
     m_bPlayerNameToMake            db ?
     m_bPlayerCreated               db ?
                                    db ? ; padding
                                    db ? ; padding
     m_idLocalPlayer                dd ?
     m_sLocalPlayerName             CString <>
     m_nTotalPlayers                dd ?
     m_psPlayerName                 CString 6 dup ({})
     m_pPlayerID                    dd 6 dup (?)
     m_pbPlayerVisible              db 6 dup (?)
     m_pbPlayerEnumerateFlag        db 6 dup (?)
     m_nLocalPlayer                 dd ?
     m_nHostPlayer                  dd ?
     m_sHostIPAddress               CString <>
     m_bAnnounceNewPlayers          dd ?
     m_pSlidingWindow               CNetworkWindow 6 dup ({})
     m_SystemWindow                 CNetworkWindow <>
     m_dwCRC32                      dd 256 dup (?)
     m_connectionSettings           CNetworkConnectionSettings <>
     m_lastMessage                  dd ?
   CNetwork                         ends
      

.. _CNetworkConnectionSettings:

CNetworkConnectionSettings
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

+------------+----------+----------------------------------------+-------------------------------+
| **Offset** | **Size** | **Type**                               | **Field**                     |
+------------+----------+----------------------------------------+-------------------------------+
| 0x00       | 4        | unsigned long                          | dwFlags                       |
+------------+----------+----------------------------------------+-------------------------------+
| 0x04       | 4        | unsigned long                          | dwMaxPlayers                  |
+------------+----------+----------------------------------------+-------------------------------+
| 0x08       | 4        | :ref:`CString<CString>`                | sPlayerName                   |
+------------+----------+----------------------------------------+-------------------------------+

Asm Definition

::

   CNetworkConnectionSettings   struct
     dwFlags                    dd ?
     dwMaxPlayers               dd ?
     sPlayerName                CString <>
   CNetworkConnectionSettings   ends


.. _CNetworkWindow:

CNetworkWindow
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

+------------+----------+----------------------------------------+-------------------------------+
| **Offset** | **Size** | **Type**                               | **Field**                     |
+------------+----------+----------------------------------------+-------------------------------+
| 0x00       | 1        | unsigned char                          | m_bInitialized                |
+------------+----------+----------------------------------------+-------------------------------+
| 0x01       | 1        | unsigned char                          | m_bVSSent                     |
+------------+----------+----------------------------------------+-------------------------------+
| 0x02       | 1        | unsigned char                          | m_bVSReceived                 |
+------------+----------+----------------------------------------+-------------------------------+
| 0x03       | 1        | unsigned char                          | m_nPlayerNumber               |
+------------+----------+----------------------------------------+-------------------------------+
| 0x04       | 2        | unsigned short                         | m_nAckExpected                |
+------------+----------+----------------------------------------+-------------------------------+
| 0x06       | 2        | unsigned short                         | m_nNextFrameToSend            |
+------------+----------+----------------------------------------+-------------------------------+
| 0x08       | 2        | unsigned short                         | m_nFrameExpected              |
+------------+----------+----------------------------------------+-------------------------------+
| 0x0A       | 2        | unsigned short                         | m_nTooFar                     |
+------------+----------+----------------------------------------+-------------------------------+
| 0x0C       | 2        | unsigned short                         | m_nOldestFrame                |
+------------+----------+----------------------------------------+-------------------------------+
|            | 2        |                                        | ``<padding>``                 |
+------------+----------+----------------------------------------+-------------------------------+
| 0x10       | 20       | ``cnetworkwindow_queueentry_st``       | m_pOutgoingBuffers[1]         |
+------------+----------+----------------------------------------+-------------------------------+
| 0x24       | 20       | ``cnetworkwindow_queueentry_st``       | m_pIncomingBuffers[1]         |
+------------+----------+----------------------------------------+-------------------------------+
| 0x38       | 28       | :ref:`CTypedPtrList<CTypedPtrList>`    | m_lQueueIncomingMessages      |
+------------+----------+----------------------------------------+-------------------------------+
| 0x54       | 28       | :ref:`CTypedPtrList<CTypedPtrList>`    | m_lQueueOutgoingMessages      |
+------------+----------+----------------------------------------+-------------------------------+
| 0x70       | 1        | unsigned char                          | m_pbTimeOutSet[1]             |
+------------+----------+----------------------------------------+-------------------------------+
|            | 3        |                                        | ``<padding>``                 |
+------------+----------+----------------------------------------+-------------------------------+
| 0x74       | 4        | unsigned long                          | m_pnTimeOut[1]                |
+------------+----------+----------------------------------------+-------------------------------+
| 0x78       | 1        | unsigned char                          | m_pbArrived[1]                |
+------------+----------+----------------------------------------+-------------------------------+
|            | 1        |                                        | ``<padding>``                 |
+------------+----------+----------------------------------------+-------------------------------+
| 0x7A       | 2        | unsigned short                         | m_nNumBuffered                |
+------------+----------+----------------------------------------+-------------------------------+
| 0x7C       | 1        | unsigned char                          | m_bNoNak                      |
+------------+----------+----------------------------------------+-------------------------------+
| 0x7D       | 1        | unsigned char                          | padding                       |
+------------+----------+----------------------------------------+-------------------------------+
|            | 2        |                                        | ``<padding>``                 |
+------------+----------+----------------------------------------+-------------------------------+
| 0x80       | 4        | unsigned long                          | m_nPacketTimeout              |
+------------+----------+----------------------------------------+-------------------------------+
| 0x84       | 4        | unsigned long                          | m_nAckTimer                   |
+------------+----------+----------------------------------------+-------------------------------+
| 0x88       | 1        | unsigned char                          | m_bAckTimerSet                |
+------------+----------+----------------------------------------+-------------------------------+
| 0x89       | 1        | unsigned char                          | m_bSomethingHappened          |
+------------+----------+----------------------------------------+-------------------------------+
|            | 2        |                                        | ``<padding>``                 |
+------------+----------+----------------------------------------+-------------------------------+
| 0x8C       | 4        | unsigned long                          | m_nNextEvent                  |
+------------+----------+----------------------------------------+-------------------------------+
| 0x90       | 4        | unsigned long                          | m_nPlayerTimeout              |
+------------+----------+----------------------------------------+-------------------------------+
| 0x94       | 4        | unsigned long                          | m_nNoMessageTimeout           |
+------------+----------+----------------------------------------+-------------------------------+

Asm Definition

::

   CNetworkWindow               struct
     m_bInitialized             db ?
     m_bVSSent                  db ?
     m_bVSReceived              db ?
     m_nPlayerNumber            db ?
     m_nAckExpected             dw ?
     m_nNextFrameToSend         dw ?
     m_nFrameExpected           dw ?
     m_nTooFar                  dw ?
     m_nOldestFrame             dw ?
                                dw ? ; padding
     m_pOutgoingBuffers         cnetworkwindow_queueentry_st <>
     m_pIncomingBuffers         cnetworkwindow_queueentry_st <>
     m_lQueueIncomingMessages   CTypedPtrList <>
     m_lQueueOutgoingMessages   CTypedPtrList <>
     m_pbTimeOutSet             db ?
                                db ? ; padding
                                db ? ; padding
                                db ? ; padding
     m_pnTimeOut                dd ?
     m_pbArrived                db ?
                                db ? ; padding
     m_nNumBuffered             dw ?
     m_bNoNak                   db ?
     padding                    db ?
                                db ? ; padding
                                db ? ; padding
     m_nPacketTimeout           dd ?
     m_nAckTimer                dd ?
     m_bAckTimerSet             db ?
     m_bSomethingHappened       db ?
                                db ? ; padding
                                db ? ; padding
     m_nNextEvent               dd ?
     m_nPlayerTimeout           dd ?
     m_nNoMessageTimeout        dd ?
   CNetworkWindow               ends

